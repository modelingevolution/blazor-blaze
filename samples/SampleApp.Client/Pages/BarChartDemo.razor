@page "/barchart"
@rendermode InteractiveWebAssembly
@using BlazorBlaze.Charts
@using SkiaSharp
@using SkiaSharp.Views.Blazor

<PageTitle>Bar Chart Demo</PageTitle>

<h1>Bar Chart Demo</h1>

<div style="width: 600px; height: 400px; border: 1px solid #ccc;">
    <SKCanvasView @ref="_canvasView" OnPaintSurface="OnPaintSurface" style="width: 100%; height: 100%;" />
</div>

<div class="mt-3">
    <button class="btn btn-primary" @onclick="Randomize">Randomize Data</button>
</div>

@code {
    private SKCanvasView? _canvasView;
    private BarChart _chart = new();
    private string[] _labels = { "CPU", "Memory", "Disk", "Network", "GPU" };
    private float[] _values = { 45.2f, 72.8f, 33.1f, 55.0f, 88.5f };

    protected override void OnInitialized()
    {
        UpdateChart();
    }

    private void UpdateChart()
    {
        _chart.SetData(
            title: "System Resources",
            labels: _labels,
            labelCount: _labels.Length,
            values: _values,
            valueCount: _values.Length,
            minScale: 0f,
            maxScale: 100f,
            units: "%",
            valueFormat: "{0:F1}",
            enableMinMaxTracking: true
        );
    }

    private void Randomize()
    {
        var rand = Random.Shared;
        for (int i = 0; i < _values.Length; i++)
        {
            _values[i] = rand.NextSingle() * 100f;
        }
        UpdateChart();
        _canvasView?.Invalidate();
    }

    private void OnPaintSurface(SKPaintSurfaceEventArgs e)
    {
        var canvas = e.Surface.Canvas;
        canvas.Clear(new SKColor(30, 30, 40));

        _chart.Location = new SKPoint(0, 0);
        _chart.Size = new SKSize(e.Info.Width, e.Info.Height);
        _chart.Render(canvas);
    }
}
